{
    "URL": "https://github.com/verilator/verilator/issues/3166",
    "Summary": "'No dtype on node with hasDType()' internal error",
    "Description": "Thanks for taking the time to report this.\nCan you attach an example that shows the issue?  (Must be openly licensed, ideally in test_regress format.)\nWhen running without --debug, this results in a crash. When running in the regression suite, I receive the error above.\nThis appears to result from at least two scenarios:\n\nPassing a scoped enumerator to a class constructor\nCalling the constructor for the current class and passing local fields to the constructor (pattern: clone method)\n\nI've updated two current regression-suite tests to show the error.\nt_class_enum.v\nmodule t (/*AUTOARG*/);\n\nclass Cls;\n   typedef enum {A = 10, B = 20, C = 30} en_t;\n   en_t m_en;\n\n   function new(en_t v);\n       m_en = v;\n   endfunction\nendclass\n\n   initial begin\n      Cls c;\n      if (c.A != 10) $stop;\n      c = new(Cls::B);\n      if (c.m_en != 20) $stop;\n      $write(\"*-* All Finished *-*\\n\");\n      $finish;\n   end\nendmodule\n\nAddition of the `new' method and call to constructor triggers the error.\nt_class_new.v\nModifying Cls2Arg by adding the clone method triggers the error.\nclass Cls2Arg;\n   int imembera;\n   int imemberb;\n   function new(int i, int j);\n      imembera = i + 1;\n      imemberb = j + 2;\n   endfunction\n\n   function Cls2Arg clone();\n      Cls2Arg ret;\n      ret = new(imembera, imemberb);\n      return ret;\n   endfunction\nendclass\n\nWhat 'verilator --version' are you using?  Did you try it with the git master version?\nI'm using 'master' as of 20211010 updated 20:05 PDT.\nWould you be willing to try to fix Verilator yourself with assistance?\nAbsolutely. I think it would be helpful to understand where a node's DType is expected to be set, and possible reasons for it not being set."
}