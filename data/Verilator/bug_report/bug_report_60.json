{
    "URL": "https://github.com/verilator/verilator/issues/3231",
    "Summary": "Listing package twice in command list results in broken link in node crash",
    "Description": "Can you attach an example that shows the issue?  (Must be openly licensed, ideally in test_regress format.)\n$ cat pkg.sv\npackage pkg;\nendpackage\n$ cat top.sv\nmodule top import pkg::*; #(\n) (\n);\nendmodule\n$ cat a.f\npkg.sv\n$ cat b.f\npkg.sv\ntop.sv\nWhen calling\nverilator --lint-only -f a.f -f b.f --debug --gdbbt\nI get\nNo stack.\n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/lib64/libthread_db.so.1\".\nStarting Verilator 4.216 2021-12-05 rev v4.216\n- Verilator.cpp:559:  Option --verilate: Start Verilation\n- V3ParseImp.cpp:273: parseFile: pkg\n  Preprocessing pkg.sv\n- V3PreShell.cpp:147:     Reading pkg.sv\n- V3ParseImp.cpp:322: Lexing pkg.sv\n- V3ParseImp.cpp:273: parseFile: pkg\n  Preprocessing pkg.sv\n- V3PreShell.cpp:147:     Reading pkg.sv\n- V3ParseImp.cpp:322: Lexing pkg.sv\n- V3ParseImp.cpp:273: parseFile: top\n  Preprocessing top.sv\n- V3PreShell.cpp:147:     Reading top.sv\n- V3ParseImp.cpp:322: Lexing top.sv\n%Warning-MODDUP: pkg.sv:1:9: Duplicate declaration of module: 'pkg'\n    1 | package pkg;\n      |         ^~~\n                 pkg.sv:1:9: ... Location of original declaration\n    1 | package pkg;\n      |         ^~~\n-node: PACKAGE 0xdfec40 <e9#> {e1aj} u4=0xdfed70  pkg  L0 [LIB] [NONE]\n                 ... For warning description see https://verilator.org/warn/MODDUP?v=4.216\n                 ... Use \"/* verilator lint_off MODDUP */\" and lint_on around source to disable this message.\ndot -Tpdf -o ~/a.pdf obj_dir/Vpkg_001_linkcells.dot\n- V3LinkLevel.cpp:45: modSortByLevel()\n- V3Ast.cpp:1127:     Dumping obj_dir/Vpkg_002_cells.tree\n%Error: Internal Error: top.sv:1:22: ../V3Broken.cpp:195: Broken link in node (or something without maybePointedTo): '!m_packagep || !m_packagep->brokeExists()' @ ../V3AstNodes.h:2663\n-node: PACKAGEIMPORT 0xdf5830 <e12> {f1aw}  * -> PACKAGE 0xdfec40 <e15> {e1aj}  pkg  L3 [LIB] [NONE]\n    1 | module top import pkg::*; #(\n      |                      ^~\n- V3Ast.cpp:1127:     Dumping obj_dir/Vpkg_990_final.tree\n- V3Broken.cpp:343:   Broken called under broken, skipping recursion.\n- V3StatsReport.cpp:220:statsReport: \n%Error: Internal Error: Aborting since under --debug\n\nProgram received signal SIGABRT, Aborted.\n__pthread_kill_implementation (threadid=<optimized out>, signo=signo@entry=6, no_tid=no_tid@entry=0) at pthread_kill.c:44\n44            return INTERNAL_SYSCALL_ERROR_P (ret) ? INTERNAL_SYSCALL_ERRNO (ret) : 0;\n#0  __pthread_kill_implementation (threadid=<optimized out>, signo=signo@entry=6, no_tid=no_tid@entry=0) at pthread_kill.c:44\n#1  0x00007ffff7d2e323 in __pthread_kill_internal (signo=6, threadid=<optimized out>) at pthread_kill.c:78\n#2  0x00007ffff7cde366 in __GI_raise (sig=sig@entry=6) at ../sysdeps/posix/raise.c:26\n#3  0x00007ffff7cc77d3 in __GI_abort () at abort.c:79\n#4  0x000000000062bc4b in V3Error::vlAbort () at ../V3Error.cpp:171\n#5  0x000000000062c4d5 in V3Error::vlAbortOrExit () at ../V3Error.cpp:163\n#6  0x000000000062e25f in V3Error::v3errorEnd (sstr=..., locationStr=...) at ../V3Error.cpp:287\n#7  0x000000000065125c in FileLine::v3errorEnd (this=this@entry=0xdf5790, sstr=..., locationStr=...) at ../V3FileLine.cpp:359\n#8  0x000000000042f18a in AstNode::v3errorEnd (this=this@entry=0xdf5830, str=...) at ../V3Ast.cpp:1208\n#9  0x000000000042f277 in AstNode::v3errorEndFatal (this=this@entry=0xdf5830, str=...) at ../V3Ast.cpp:1151\n#10 0x000000000046bd94 in BrokenCheckVisitor::processEnter (this=this@entry=0x7fffffffd190, nodep=nodep@entry=0xdf5830) at ../V3Error.h:312\n#11 0x000000000046c3f3 in BrokenCheckVisitor::processAndIterate (nodep=0xdf5830, this=0x7fffffffd190) at ../V3Broken.cpp:220\n#12 BrokenCheckVisitor::visit (this=0x7fffffffd190, nodep=0xdf5830) at ../V3Broken.cpp:326\n#13 0x000000000040de7d in AstNVisitor::visit (this=<optimized out>, nodep=<optimized out>) at ./V3Ast__gen_visitor.h:268\n#14 0x000000000044952a in AstPackageImport::accept (this=<optimized out>, v=...) at ../V3AstNodes.h:2661\n#15 0x000000000042cb9c in AstNode::iterateAndNextConst (this=<optimized out>, v=...) at ../V3Ast.cpp:882\n#16 0x000000000042cc2c in AstNode::iterateChildrenConst (this=this@entry=0xe03a40, v=...) at ../V3Ast.cpp:816\n#17 0x000000000046c3fe in AstNVisitor::iterateChildrenConst (nodep=0xe03a40, this=0x7fffffffd190) at ../V3Ast.h:3001\n#18 BrokenCheckVisitor::processAndIterate (nodep=0xe03a40, this=0x7fffffffd190) at ../V3Broken.cpp:221\n#19 BrokenCheckVisitor::visit (this=0x7fffffffd190, nodep=0xe03a40) at ../V3Broken.cpp:326\n#20 0x000000000040dc85 in AstNVisitor::visit (this=<optimized out>, nodep=<optimized out>) at ./V3Ast__gen_visitor.h:240\n#21 0x000000000040da33 in AstNVisitor::visit (this=<optimized out>, nodep=<optimized out>) at ./V3Ast__gen_visitor.h:206\n#22 0x00000000004494c4 in AstModule::accept (this=<optimized out>, v=...) at ../V3AstNodes.h:2581\n#23 0x000000000042cb9c in AstNode::iterateAndNextConst (this=<optimized out>, v=...) at ../V3Ast.cpp:882\n#24 0x000000000042cc1b in AstNode::iterateChildrenConst (this=this@entry=0xde13a0, v=...) at ../V3Ast.cpp:815\n#25 0x000000000046c3fe in AstNVisitor::iterateChildrenConst (nodep=0xde13a0, this=0x7fffffffd190) at ../V3Ast.h:3001\n#26 BrokenCheckVisitor::processAndIterate (nodep=0xde13a0, this=0x7fffffffd190) at ../V3Broken.cpp:221\n#27 BrokenCheckVisitor::visit (this=0x7fffffffd190, nodep=0xde13a0) at ../V3Broken.cpp:326\n#28 0x000000000040db0b in AstNVisitor::visit (this=<optimized out>, nodep=<optimized out>) at ./V3Ast__gen_visitor.h:218\n#29 0x0000000000449e72 in AstNetlist::accept (this=<optimized out>, v=...) at ../V3AstNodes.h:9209\n#30 0x0000000000468377 in AstNVisitor::iterate (nodep=0xde13a0, this=0x7fffffffd190) at ../V3Ast.h:2992\n#31 BrokenCheckVisitor::BrokenCheckVisitor (nodep=0xde13a0, this=0x7fffffffd190) at ../V3Broken.cpp:331\n#32 V3Broken::brokenAll (nodep=nodep@entry=0xde13a0) at ../V3Broken.cpp:347\n#33 0x0000000000435963 in AstNode::dumpTreeFile (this=this@entry=0xde13a0, filename=..., append=append@entry=false, doDump=doDump@entry=true, doCheck=doCheck@entry=true) at ../V3Ast.cpp:1146\n#34 0x000000000066a032 in V3Global::dumpCheckGlobalTree (stagename=..., newNumber=newNumber@entry=0, doDump=doDump@entry=true) at ../V3Global.cpp:92\n#35 0x0000000000729cb1 in V3LinkLevel::modSortByLevel () at ../V3LinkLevel.cpp:84\n#36 0x0000000000406ef7 in process () at ../Verilator.cpp:118\n#37 0x000000000040951c in verilate (argString=...) at ../Verilator.cpp:602\n#38 0x000000000040a06f in main (argc=<optimized out>, argv=0x7fffffffd858, env=<optimized out>) at ../Verilator.cpp:728\nA debugging session is active.\n\n        Inferior 1 [process 13846] will be killed.\n\nQuit anyway? (y or n) [answered Y; input not from terminal]\n%Error: export VERILATOR_ROOT=\n%Error: setarch --addr-no-randomize gdb /home/bluew/.local/bin/verilator_bin_dbg --batch --quiet --return-child-result -ex \"run --lint-only -f a.f -f b.f --debug --gdbbt\" -ex 'set width 0' -ex 'bt' -ex 'quit'\n%Error: Command Failed setarch --addr-no-randomize gdb /home/bluew/.local/bin/verilator_bin_dbg --batch --quiet --return-child-result -ex \"run --lint-only -f a.f -f b.f --debug --gdbbt\" -ex 'set width 0' -ex 'bt' -ex 'quit'\n\nWhat 'verilator --version' are you using?  Did you try it with the git master version?\nVerilator 4.216 2021-12-05 rev v4.216\nWhat OS and distribution are you using?\nNAME=\"openSUSE Tumbleweed\"\n# VERSION=\"20211124\"\n\nWould you be willing to try to fix Verilator yourself with assistance?\nYes"
}