{
    "URL": "https://github.com/verilator/verilator/issues/3182",
    "Summary": "incorrect constant propogation",
    "Description": "Using Verilator 4.215 devel rev v4.214-9-g20e896ec.\nVerilog is\nwire  _T_742 = ~io_resps_sink_c_bits_source[7]; // @[Parameters.scala 54:32]\nwire  _T_745 = io_resps_sink_c_bits_source[6:0] <= 7'h40; // @[Parameters.scala 57:20]\nwire  probeack_bit = _T_742 & _T_745; // @[Parameters.scala 56:50]\n\nThe assignment in cpp looks like:\n// verilator v4.215\nvlSelf->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__l2cache__DOT__slices_0__DOT__c_mshr__DOT__probeack_bit = 0U;\nvlSelf->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__l2cache__DOT__slices_0__DOT__abc_mshr_0__DOT__probeack_bit = 0U;\nvlSelf->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__l2cache__DOT__slices_0__DOT__abc_mshr_1__DOT__probeack_bit = 0U;\nvlSelf->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__l2cache__DOT__slices_0__DOT__abc_mshr_2__DOT__probeack_bit = 0U;\nvlSelf->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__l2cache__DOT__slices_0__DOT__abc_mshr_3__DOT__probeack_bit = 0U;\nvlSelf->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__l2cache__DOT__slices_0__DOT__abc_mshr_12__DOT__probeack_bit = 0U;\nvlSelf->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__l2cache__DOT__slices_0__DOT__abc_mshr_13__DOT__probeack_bit = 0U;\nvlSelf->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__l2cache__DOT__slices_0__DOT__abc_mshr_14__DOT__probeack_bit = 0U;\nvlSelf->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__l2cache__DOT__slices_0__DOT__abc_mshr_15__DOT__probeack_bit = 0U;\nvlSelf->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__l2cache__DOT__slices_0__DOT__bc_mshr__DOT__probeack_bit = 0U;\n\nHowever, in v4.204 it works.\n// verilator v4.204\nvlTOPp->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__l2cache__DOT__slices_0__DOT__bc_mshr__DOT__probeack_bit\n        = ((~ ((IData)(vlTOPp->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__core__DOT__memBlock__DOT__dcache__DOT__dcache__DOT__wb_io_mem_release_bits_source)\n               >> 7U)) & (0x40U >= (IData)(vlTOPp->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__core__DOT__memBlock__DOT__dcache__DOT__dcache__DOT__wb_io_mem_release_bits_source)));\n\nI search the files produced by v4.215 for the memBlock*wb* signals and find that\n    vlSelf->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__core__DOT__memBlock__DOT__dcache__DOT__dcache__DOT__wb_io_mem_release_bits_source\n        = ((((((((((((IData)(vlSelf->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__core__DOT__memBlock__DOT__dcache__DOT__dcache__DOT__wb__DOT___T_1842)\n                     | ((IData)(vlSelf->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__core__DOT__memBlock__DOT__dcache__DOT__dcache__DOT__wb__DOT___T_1157_21)\n                         ? 0x35U : 0U)) | ((IData)(vlSelf->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__core__DOT__memBlock__DOT__dcache__DOT__dcache__DOT__wb__DOT___T_1157_22)\n                                            ? 0x36U\n                                            : 0U))\n                   | ((IData)(vlSelf->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__core__DOT__memBlock__DOT__dcache__DOT__dcache__DOT__wb__DOT___T_1157_23)\n                       ? 0x37U : 0U)) | ((IData)(vlSelf->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__core__DOT__memBlock__DOT__dcache__DOT__dcache__DOT__wb__DOT___T_1157_24)\n                                          ? 0x38U : 0U))\n                 | ((IData)(vlSelf->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__core__DOT__memBlock__DOT__dcache__DOT__dcache__DOT__wb__DOT___T_1157_25)\n                     ? 0x39U : 0U)) | ((IData)(vlSelf->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__core__DOT__memBlock__DOT__dcache__DOT__dcache__DOT__wb__DOT___T_1157_26)\n                                        ? 0x3aU : 0U))\n               | ((IData)(vlSelf->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__core__DOT__memBlock__DOT__dcache__DOT__dcache__DOT__wb__DOT___T_1157_27)\n                   ? 0x3bU : 0U)) | ((IData)(vlSelf->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__core__DOT__memBlock__DOT__dcache__DOT__dcache__DOT__wb__DOT___T_1157_28)\n                                      ? 0x3cU : 0U))\n             | ((IData)(vlSelf->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__core__DOT__memBlock__DOT__dcache__DOT__dcache__DOT__wb__DOT___T_1157_29)\n                 ? 0x3dU : 0U)) | ((IData)(vlSelf->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__core__DOT__memBlock__DOT__dcache__DOT__dcache__DOT__wb__DOT___T_1157_30)\n                                    ? 0x3eU : 0U))\n           | ((IData)(vlSelf->SimTop__DOT__l_soc__DOT__core_with_l2__DOT__core__DOT__memBlock__DOT__dcache__DOT__dcache__DOT__wb__DOT___T_1157_31)\n               ? 0x3fU : 0U));\n\nI presume the signal is always less than 0x40U. Thus, io_resps_sink_c_bits_source[7] is always false, which implies _T_742 is always true, and  _T_745 is always true as well. Therefore, probeack_bit should always be true.\nI think it should be some incorrect constant propogation assignments.\nThe verilog is attached. *.cpp files are too many and I removed them.\nexport NOOP_HOME=/path/to/XiangShan\nmake -C difftest emu_mk\n\nXiangShan.tar.gz"
}