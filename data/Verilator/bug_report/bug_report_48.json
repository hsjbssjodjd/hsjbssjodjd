{
    "URL": "https://github.com/verilator/verilator/issues/3547",
    "Summary": "String literal in function argument converted to unsigned long long instead of std::string",
    "Description": "Found on verilator master branch\nA string literal in a function argument is incorrectly converted to unsigned long long instead of std::string\nI needed to put the function in a package and a class, I think to avoid optimazations that hid this problem.\nThe following verilog code:\nfile: tjo_p.sv\npackage tjo_p;\n    class Tjo;\n        function automatic string broken_str_arg(input string some_string);\n            $display(some_string);\n            return some_string;\n        endfunction\n    endclass\nendpackage\nfile: tjo.sv\nmodule tjo();\n\ninitial begin\n    tjo_p::Tjo tc;\n    string bar = \"baar\";\n    $display(tc.broken_str_arg(\"foo\"));\n    $display(tc.broken_str_arg(bar));\nend\nendmodule\nGets converted into this cpp code:\nVL_ATTR_COLD void Vtjo___024root___initial__TOP__0(Vtjo___024root* vlSelf) {\n    if (false && vlSelf) {}  // Prevent unused\n    Vtjo__Syms* const __restrict vlSymsp VL_ATTR_UNUSED = vlSelf->vlSymsp;\n    VL_DEBUG_IF(VL_DBG_MSGF(\"+    Vtjo___024root___initial__TOP__0\\n\"); );\n    // Init\n    std::string __Vtask_broken_str_arg__0__Vfuncout;\n    std::string __Vtask_broken_str_arg__1__Vfuncout;\n    // Body\n    VL_NULL_CHECK(vlSelf->tjo__DOT__unnamedblk1__DOT__tc, \"tjo.sv\", 6)->__VnoInFunc_broken_str_arg(vlSymsp, 0x666f6fU, __Vtask_broken_str_arg__0__Vfuncout);\n    VL_WRITEF(\"%@\\n\",-1,&(__Vtask_broken_str_arg__0__Vfuncout));\n    VL_NULL_CHECK(vlSelf->tjo__DOT__unnamedblk1__DOT__tc, \"tjo.sv\", 7)->__VnoInFunc_broken_str_arg(vlSymsp, \n                                                                                std::string(\"baar\"), __Vtask_broken_str_arg__1__Vfuncout);\n    VL_WRITEF(\"%@\\n\",-1,&(__Vtask_broken_str_arg__1__Vfuncout));\n}\nThe interesting parts:\n    VL_NULL_CHECK(vlSelf->tjo__DOT__unnamedblk1__DOT__tc, \"tjo.sv\", 6)->__VnoInFunc_broken_str_arg(vlSymsp, 0x666f6fU, __Vtask_broken_str_arg__0__Vfuncout);\n    ...\n    VL_NULL_CHECK(vlSelf->tjo__DOT__unnamedblk1__DOT__tc, \"tjo.sv\", 7)->__VnoInFunc_broken_str_arg(vlSymsp, \n                                                                                std::string(\"baar\"), __Vtask_broken_str_arg__1__Vfuncout);"
}